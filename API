-- OmniUI API 1.0.2

local OmniUI = {
    Version = "1.2.2",
    Build = "OMNI-CYBERFORGE-V2",
    Flags = {},
    Themes = {
        CyberForge = {
            TextColor = Color3.fromRGB(255, 255, 255),
            TextGlow = Color3.fromRGB(0, 255, 149), -- Неоново-зелёный
            Background = Color3.fromRGB(10, 10, 15),
            BackgroundGradient = {Color3.fromRGB(10, 10, 15), Color3.fromRGB(20, 20, 30)},
            Topbar = Color3.fromRGB(15, 15, 20),
            Shadow = Color3.fromRGB(0, 0, 0),
            ElementBackground = Color3.fromRGB(20, 20, 25),
            ElementBackgroundHover = Color3.fromRGB(30, 30, 35),
            ElementStroke = Color3.fromRGB(0, 255, 149),
            SecondaryElementStroke = Color3.fromRGB(50, 50, 60),
            SliderBackground = Color3.fromRGB(30, 30, 35),
            SliderProgress = Color3.fromRGB(0, 255, 149),
            SliderStroke = Color3.fromRGB(0, 200, 120),
            ToggleBackground = Color3.fromRGB(25, 25, 30),
            ToggleEnabled = Color3.fromRGB(0, 255, 149),
            ToggleDisabled = Color3.fromRGB(60, 60, 70),
            ToggleEnabledStroke = Color3.fromRGB(0, 200, 120),
            ToggleDisabledStroke = Color3.fromRGB(70, 70, 80),
            DropdownSelected = Color3.fromRGB(25, 25, 30),
            DropdownUnselected = Color3.fromRGB(20, 20, 25),
            InputBackground = Color3.fromRGB(20, 20, 25),
            InputStroke = Color3.fromRGB(0, 255, 149),
            PlaceholderColor = Color3.fromRGB(100, 100, 110),
            NotificationBackground = Color3.fromRGB(15, 15, 20),
            NotificationStroke = Color3.fromRGB(0, 255, 149),
        },
        NeonTokyo = {
            TextColor = Color3.fromRGB(255, 255, 255),
            TextGlow = Color3.fromRGB(255, 105, 180), -- Неоново-розовый
            Background = Color3.fromRGB(15, 15, 20),
            BackgroundGradient = {Color3.fromRGB(15, 15, 20), Color3.fromRGB(25, 25, 35)},
            Topbar = Color3.fromRGB(20, 20, 25),
            Shadow = Color3.fromRGB(0, 0, 0),
            ElementBackground = Color3.fromRGB(25, 25, 30),
            ElementBackgroundHover = Color3.fromRGB(35, 35, 40),
            ElementStroke = Color3.fromRGB(255, 105, 180),
            SecondaryElementStroke = Color3.fromRGB(60, 60, 70),
            SliderBackground = Color3.fromRGB(35, 35, 40),
            SliderProgress = Color3.fromRGB(255, 105, 180),
            SliderStroke = Color3.fromRGB(200, 80, 140),
            ToggleBackground = Color3.fromRGB(30, 30, 35),
            ToggleEnabled = Color3.fromRGB(255, 105, 180),
            ToggleDisabled = Color3.fromRGB(70, 70, 80),
            ToggleEnabledStroke = Color3.fromRGB(200, 80, 140),
            ToggleDisabledStroke = Color3.fromRGB(80, 80, 90),
            DropdownSelected = Color3.fromRGB(30, 30, 35),
            DropdownUnselected = Color3.fromRGB(25, 25, 30),
            InputBackground = Color3.fromRGB(25, 25, 30),
            InputStroke = Color3.fromRGB(255, 105, 180),
            PlaceholderColor = Color3.fromRGB(110, 110, 120),
            NotificationBackground = Color3.fromRGB(20, 20, 25),
            NotificationStroke = Color3.fromRGB(255, 105, 180),
        },
    },
}

-- Сервисы Roblox
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local PlayerGui = Players.LocalPlayer and Players.LocalPlayer:WaitForChild("PlayerGui")

-- Конфигурация
local Config = {
    Folder = "OmniUI",
    ConfigFile = "settings.json",
    API_URL = "https://mock.api/roblox", -- Мок для тестирования
    AnalyticsEnabled = true,
    DefaultKeybind = "K",
    Font = Enum.Font.SourceSans, -- Стандартный шрифт Roblox
}

-- Модуль анимаций
local Animations = {}

--- Создаёт анимацию для объекта
-- @param instance Экземпляр Roblox для анимации
-- @param properties Таблица свойств для анимации
-- @param duration Длительность анимации (в секундах)
-- @param easingStyle Стиль анимации (по умолчанию Quad)
-- @param easingDirection Направление анимации (по умолчанию Out)
-- @return Tween
function Animations:Create(instance, properties, duration, easingStyle, easingDirection)
    local tweenInfo = TweenInfo.new(
        duration or 0.3,
        easingStyle or Enum.EasingStyle.Quad,
        easingDirection or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(instance, tweenInfo, properties)
    tween:Play()
    return tween
end

--- Создаёт пульсирующий эффект для UIStroke
-- @param stroke Экземпляр UIStroke
-- @param minTransparency Минимальная прозрачность
-- @param maxTransparency Максимальная прозрачность
-- @param duration Длительность цикла
-- @return Tween
function Animations:Pulse(stroke, minTransparency, maxTransparency, duration)
    local tween = TweenService:Create(
        stroke,
        TweenInfo.new(duration or 1, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
        { Transparency = maxTransparency }
    )
    tween:Play()
    return tween
end

-- Модуль API
local API = {}

--- Проверяет, включены ли HTTP-запросы
-- @return boolean
local function isHttpEnabled()
    local success, enabled = pcall(function()
        return HttpService:GetHttpEnabled()
    end)
    return success and enabled
end

--- Получает данные игрока
-- @param playerId ID игрока
-- @return table|nil Данные игрока или nil при ошибке
function API:GetPlayerData(playerId)
    if not isHttpEnabled() then
        warn("API Error: HTTP-запросы отключены в настройках игры")
        return nil
    end
    local success, result = pcall(function()
        return HttpService:GetAsync(Config.API_URL .. "/player/" .. tostring(playerId))
    end)
    if success then
        return HttpService:JSONDecode(result)
    else
        warn("API Error: Не удалось получить данные игрока: " .. tostring(result))
        return nil
    end
end

--- Обновляет инвентарь игрока
-- @param playerId ID игрока
-- @param itemId ID предмета
-- @param quantity Количество
-- @return table|nil Результат или nil при ошибке
function API:UpdateInventory(playerId, itemId, quantity)
    if not isHttpEnabled() then
        warn("API Error: HTTP-запросы отключены в настройках игры")
        return nil
    end
    local success, result = pcall(function()
        return HttpService:PostAsync(
            Config.API_URL .. "/inventory/update",
            HttpService:JSONEncode({ playerId = playerId, itemId = itemId, quantity = quantity }),
            Enum.HttpContentType.ApplicationJson
        )
    end)
    if success then
        return HttpService:JSONDecode(result)
    else
        warn("API Error: Не удалось обновить инвентарь: " .. tostring(result))
        return nil
    end
end

-- Модуль иконок
local Icons = {
    Default = "rbxassetid://4483362458",
    Warning = "rbxassetid://1234567890", -- Заменить на реальный ID
    Error = "rbxassetid://0987654321",   -- Заменить на реальный ID
    Info = "rbxassetid://1122334455",    -- Заменить на реальный ID
}

--- Получает иконку по имени
-- @param name Имя иконки
-- @return string Roblox Asset ID
function Icons:GetIcon(name)
    return Icons[name] or Icons.Default
end

-- Модуль уведомлений
local Notifications = {}

--- Создаёт уведомление
-- @param title Заголовок уведомления
-- @param content Текст уведомления
-- @param duration Длительность (в секундах)
-- @param type Тип уведомления: "Info", "Warning", "Error"
-- @return Frame Экземпляр уведомления
function Notifications:Create(title, content, duration, type)
    local notification = Instance.new("Frame")
    notification.Size = UDim2.new(0, 300, 0, 80)
    notification.Position = UDim2.new(1, -320, 1, -100 - (#CoreGui:GetChildren() * 90))
    notification.BackgroundColor3 = OmniUI.Themes.CyberForge.NotificationBackground
    notification.BackgroundTransparency = 0.3
    notification.Parent = CoreGui

    local uiGradient = Instance.new("UIGradient")
    uiGradient.Color = ColorSequence.new(OmniUI.Themes.CyberForge.BackgroundGradient)
    uiGradient.Parent = notification

    local uiStroke = Instance.new("UIStroke")
    uiStroke.Color = OmniUI.Themes.CyberForge.NotificationStroke
    uiStroke.Thickness = 2
    uiStroke.Transparency = 0.5
    uiStroke.Parent = notification

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -10, 0, 20)
    titleLabel.Position = UDim2.new(0, 5, 0, 5)
    titleLabel.Text = title
    titleLabel.TextColor3 = OmniUI.Themes.CyberForge.TextColor
    titleLabel.TextTransparency = 1
    titleLabel.Font = Config.Font
    titleLabel.TextStrokeTransparency = 0.8
    titleLabel.TextStrokeColor3 = OmniUI.Themes.CyberForge.TextGlow
    titleLabel.BackgroundTransparency = 1
    titleLabel.Parent = notification

    local contentLabel = Instance.new("TextLabel")
    contentLabel.Size = UDim2.new(1, -10, 0, 50)
    contentLabel.Position = UDim2.new(0, 5, 0, 25)
    contentLabel.Text = content
    contentLabel.TextColor3 = OmniUI.Themes.CyberForge.TextColor
    contentLabel.TextTransparency = 1
    contentLabel.Font = Config.Font
    contentLabel.TextWrapped = true
    contentLabel.BackgroundTransparency = 1
    contentLabel.Parent = notification

    -- Иконка в зависимости от типа
    local iconImage = Icons:GetIcon(type or "Info")
    local icon = Instance.new("ImageLabel")
    icon.Size = UDim2.new(0, 32, 0, 32)
    icon.Position = UDim2.new(0, 5, 0, 5)
    icon.Image = iconImage
    icon.BackgroundTransparency = 1
    icon.ImageTransparency = 1
    icon.Parent = notification

    -- Анимация появления
    Animations:Create(notification, {Position = UDim2.new(1, -320, 1, -100 - (#CoreGui:GetChildren() * 90)), BackgroundTransparency = 0.1}, 0.5)
    Animations:Create(uiStroke, {Transparency = 0}, 0.5)
    Animations:Create(titleLabel, {TextTransparency = 0}, 0.5)
    Animations:Create(contentLabel, {TextTransparency = 0.2}, 0.5)
    Animations:Create(icon, {ImageTransparency = 0}, 0.5)

    -- Пульсирующий эффект
    local pulse = Animations:Pulse(uiStroke, 0, 0.3, 1)

    task.spawn(function()
        task.wait(duration or 5)
        pulse:Cancel()
        Animations:Create(notification, {Position = UDim2.new(1, 0, 1, -100 - (#CoreGui:GetChildren() * 90)), BackgroundTransparency = 1}, 0.5)
        Animations:Create(uiStroke, {Transparency = 1}, 0.5)
        Animations:Create(titleLabel, {TextTransparency = 1}, 0.5)
        Animations:Create(contentLabel, {TextTransparency = 1}, 0.5)
        Animations:Create(icon, {ImageTransparency = 1}, 0.5)
        task.wait(0.5)
        notification:Destroy()
    end)

    return notification
end

-- Модуль конфигураций
local Configurations = {}

--- Сохраняет конфигурацию
-- @param data Данные для сохранения
function Configurations:Save(data)
    if not isfolder or not writefile then
        Notifications:Create("Ошибка", "Файловая система не поддерживается вашим исполнителем.", 5, "Error")
        return
    end
    if not isfolder(Config.Folder) then
        makefolder(Config.Folder)
    end
    local success, err = pcall(function()
        writefile(Config.Folder .. "/" .. Config.ConfigFile, HttpService:JSONEncode(data))
    end)
    if not success then
        Notifications:Create("Ошибка", "Не удалось сохранить конфигурацию: " .. tostring(err), 5, "Error")
    end
end

--- Загружает конфигурацию
-- @return table Загруженные данные или пустая таблица при ошибке
function Configurations:Load()
    if not isfile or not isfolder(Config.Folder) or not isfile(Config.Folder .. "/" .. Config.ConfigFile) then
        return {}
    end
    local success, data = pcall(function()
        return HttpService:JSONDecode(readfile(Config.Folder .. "/" .. Config.ConfigFile))
    end)
    if success then
        return data
    else
        Notifications:Create("Ошибка", "Не удалось загрузить конфигурацию: " .. tostring(data), 5, "Error")
        return {}
    end
end

-- Модуль аналитики
local Analytics = {}

--- Отправляет отчёт аналитики
function Analytics:SendReport()
    if not Config.AnalyticsEnabled then return end
    if not isHttpEnabled() then
        warn("Analytics Error: HTTP-запросы отключены")
        return
    end
    task.spawn(function()
        local success, err = pcall(function()
            return HttpService:PostAsync(
                "https://mock.analytics/report",
                HttpService:JSONEncode({ build = OmniUI.Build, version = OmniUI.Version, userId = Players.LocalPlayer.UserId }),
                Enum.HttpContentType.ApplicationJson
            )
        end)
        if not success then
            warn("Analytics Error: " .. tostring(err))
        end
    end)
end

-- Основной модуль GUI
local GUI = {
    Windows = {},
    SelectedTheme = OmniUI.Themes.CyberForge,
}

--- Меняет тему интерфейса
-- @param theme Имя темы или таблица с настройками
function GUI:ChangeTheme(theme)
    if type(theme) == "string" then
        GUI.SelectedTheme = OmniUI.Themes[theme] or OmniUI.Themes.CyberForge
    elseif type(theme) == "table" then
        GUI.SelectedTheme = theme
    end
    for _, window in pairs(GUI.Windows) do
        if window and window.MainFrame and window.Topbar and window.Title then
            window.MainFrame.BackgroundColor3 = GUI.SelectedTheme.Background
            window.MainFrame.UIGradient.Color = ColorSequence.new(GUI.SelectedTheme.BackgroundGradient)
            window.Topbar.BackgroundColor3 = GUI.SelectedTheme.Topbar
            window.Title.TextColor3 = GUI.SelectedTheme.TextColor
            window.Title.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            for _, tab in ipairs(window.Tabs) do
                tab.Instance.BackgroundColor3 = GUI.SelectedTheme.Background
                for _, element in ipairs(tab.Elements) do
                    if element:IsA("Frame") then
                        element.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
                        if element.UIStroke then
                            element.UIStroke.Color = GUI.SelectedTheme.ElementStroke
                        end
                    end
                end
            end
        end
    end
    Notifications:Create("Тема изменена", "Интерфейс теперь в стиле " .. (type(theme) == "string" and theme or "Custom"), 5, "Info")
end

--- Создаёт новое окно
-- @param settings Таблица с настройками окна
-- @return table Объект окна
function GUI:CreateWindow(settings)
    local guiParent = CoreGui
    local success, canUseCoreGui = pcall(function()
        local testGui = Instance.new("ScreenGui")
        testGui.Parent = CoreGui
        testGui:Destroy()
        return true
    end)
    if not success or not canUseCoreGui then
        warn("CoreGui недоступен, использование PlayerGui")
        guiParent = PlayerGui or error("PlayerGui недоступен")
    end

    local window = {
        Name = settings.Name or "OmniUI Hack",
        Tabs = {},
        Visible = true,
        Minimised = false,
        Hidden = false,
        Instance = Instance.new("ScreenGui"),
        MainFrame = Instance.new("Frame"),
        Topbar = Instance.new("Frame"),
        Title = Instance.new("TextLabel"),
        Notifications = Notifications,
        ConfigSaving = settings.ConfigurationSaving or { Enabled = false },
        Keybind = settings.Keybind or Config.DefaultKeybind,
    }

    window.Instance.Name = "OmniUI_" .. window.Name
    window.Instance.Parent = guiParent
    window.Instance.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    window.Instance.DisplayOrder = 1000
    window.Instance.Enabled = true
    window.Instance.ResetOnSpawn = false

    window.MainFrame.Size = UDim2.new(0, 450, 0, 400)
    window.MainFrame.Position = UDim2.new(0.5, -225, 0.5, -200)
    window.MainFrame.BackgroundColor3 = GUI.SelectedTheme.Background
    window.MainFrame.BackgroundTransparency = 0
    window.MainFrame.Parent = window.Instance
    window.MainFrame.ClipsDescendants = true

    local uiGradient = Instance.new("UIGradient")
    uiGradient.Color = ColorSequence.new(GUI.SelectedTheme.BackgroundGradient)
    uiGradient.Parent = window.MainFrame

    local uiStroke = Instance.new("UIStroke")
    uiStroke.Color = GUI.SelectedTheme.ElementStroke
    uiStroke.Thickness = 2
    uiStroke.Parent = window.MainFrame

    window.Topbar.Size = UDim2.new(1, 0, 0, 40)
    window.Topbar.BackgroundColor3 = GUI.SelectedTheme.Topbar
    window.Topbar.BackgroundTransparency = 0.2
    window.Topbar.Parent = window.MainFrame

    local topbarStroke = Instance.new("UIStroke")
    topbarStroke.Color = GUI.SelectedTheme.ElementStroke
    topbarStroke.Thickness = 1.5
    topbarStroke.Parent = window.Topbar

    window.Title.Size = UDim2.new(1, -10, 1, 0)
    window.Title.Position = UDim2.new(0, 10, 0, 0)
    window.Title.Text = window.Name
    window.Title.TextColor3 = GUI.SelectedTheme.TextColor
    window.Title.Font = Config.Font
    window.Title.TextStrokeTransparency = 0.8
    window.Title.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
    window.Title.BackgroundTransparency = 1
    window.Title.Parent = window.Topbar

    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -40, 0, 5)
    closeButton.Text = "X"
    closeButton.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
    closeButton.TextColor3 = GUI.SelectedTheme.TextColor
    closeButton.Font = Config.Font
    closeButton.Parent = window.Topbar

    local minimiseButton = Instance.new("TextButton")
    minimiseButton.Size = UDim2.new(0, 30, 0, 30)
    minimiseButton.Position = UDim2.new(1, -75, 0, 5)
    minimiseButton.Text = "-"
    minimiseButton.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
    minimiseButton.TextColor3 = GUI.SelectedTheme.TextColor
    minimiseButton.Font = Config.Font
    minimiseButton.Parent = window.Topbar

    local dragBar = Instance.new("Frame")
    dragBar.Size = UDim2.new(0, 100, 0, 4)
    dragBar.Position = UDim2.new(0.5, -50, 0, -10)
    dragBar.BackgroundColor3 = GUI.SelectedTheme.ElementStroke
    dragBar.BackgroundTransparency = 0.5
    dragBar.Parent = window.MainFrame

    local dragInteract = Instance.new("TextButton")
    dragInteract.Size = UDim2.new(1, 0, 1, 0)
    dragInteract.BackgroundTransparency = 1
    dragInteract.Text = ""
    dragInteract.Parent = dragBar

    -- Оптимизированное перетаскивание
    local dragging, dragStart, startPos
    dragInteract.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = window.MainFrame.Position
        end
    end)

    dragInteract.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            local newPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            Animations:Create(window.MainFrame, {Position = newPos}, 0.1)
        end
    end)

    dragInteract.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
        end
    end)

    closeButton.MouseButton1Click:Connect(function()
        window:SetVisible(false)
    end)

    minimiseButton.MouseButton1Click:Connect(function()
        window.Minimised = not window.Minimised
        local targetSize = window.Minimised and UDim2.new(0, 450, 0, 40) or UDim2.new(0, 450, 0, 400)
        Animations:Create(window.MainFrame, {Size = targetSize}, 0.3)
    end)

    --- Создаёт вкладку
    -- @param tabName Имя вкладки
    -- @param icon ID иконки
    -- @return table Объект вкладки
    function window:CreateTab(tabName, icon)
        local tab = {
            Name = tabName,
            Elements = {},
            Instance = Instance.new("Frame"),
            Button = Instance.new("TextButton"),
        }

        tab.Instance.Size = UDim2.new(1, 0, 1, -40)
        tab.Instance.Position = UDim2.new(0, 0, 0, 40)
        tab.Instance.BackgroundTransparency = 1
        tab.Instance.Parent = window.MainFrame
        tab.Instance.Visible = false

        tab.Button.Size = UDim2.new(0, 100, 0, 30)
        tab.Button.Position = UDim2.new(#window.Tabs * 0.2, 10, 0, 5)
        tab.Button.Text = tabName
        tab.Button.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
        tab.Button.TextColor3 = GUI.SelectedTheme.TextColor
        tab.Button.Font = Config.Font
        tab.Button.TextStrokeTransparency = 0.8
        tab.Button.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
        tab.Button.Parent = window.Topbar

        local tabStroke = Instance.new("UIStroke")
        tabStroke.Color = GUI.SelectedTheme.ElementStroke
        tabStroke.Thickness = 1
        tabStroke.Parent = tab.Button

        if icon then
            local tabIcon = Instance.new("ImageLabel")
            tabIcon.Size = UDim2.new(0, 20, 0, 20)
            tabIcon.Position = UDim2.new(0, 5, 0, 5)
            tabIcon.Image = Icons:GetIcon(icon)
            tabIcon.BackgroundTransparency = 1
            tabIcon.Parent = tab.Button
        end

        tab.Button.MouseButton1Click:Connect(function()
            for _, t in ipairs(window.Tabs) do
                t.Instance.Visible = (t == tab)
                t.Button.BackgroundColor3 = (t == tab) and GUI.SelectedTheme.ElementBackgroundHover or GUI.SelectedTheme.ElementBackground
                t.Button.UIStroke.Transparency = (t == tab) and 0 or 0.5
            end
        end)

        tab.Button.MouseEnter:Connect(function()
            Animations:Create(tab.Button, {BackgroundColor3 = GUI.SelectedTheme.ElementBackgroundHover}, 0.2)
            Animations:Create(tabStroke, {Transparency = 0}, 0.2)
        end)

        tab.Button.MouseLeave:Connect(function()
            if not tab.Instance.Visible then
                Animations:Create(tab.Button, {BackgroundColor3 = GUI.SelectedTheme.ElementBackground}, 0.2)
                Animations:Create(tabStroke, {Transparency = 0.5}, 0.2)
            end
        end)

        table.insert(window.Tabs, tab)
        if #window.Tabs == 1 then
            tab.Instance.Visible = true
            tab.Button.BackgroundColor3 = GUI.SelectedTheme.ElementBackgroundHover
            tabStroke.Transparency = 0
        end

        --- Создаёт кнопку
        -- @param name Текст кнопки
        -- @param callback Функция обратного вызова
        -- @return TextButton Экземпляр кнопки
        function tab:CreateButton(name, callback)
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, -10, 0, 35)
            button.Position = UDim2.new(0, 5, 0, #tab.Elements * 40)
            button.Text = name
            button.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
            button.TextColor3 = GUI.SelectedTheme.TextColor
            button.Font = Config.Font
            button.TextStrokeTransparency = 0.8
            button.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            button.Parent = tab.Instance

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = GUI.SelectedTheme.ElementStroke
            uiStroke.Thickness = 1.5
            uiStroke.Transparency = 0.5
            uiStroke.Parent = button

            button.MouseButton1Click:Connect(function()
                local success, err = pcall(callback)
                if not success then
                    Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                end
            end)

            button.MouseEnter:Connect(function()
                Animations:Create(button, {BackgroundColor3 = GUI.SelectedTheme.ElementBackgroundHover, Size = UDim2.new(1, -10, 0, 37)}, 0.2)
                Animations:Create(uiStroke, {Transparency = 0}, 0.2)
            end)

            button.MouseLeave:Connect(function()
                Animations:Create(button, {BackgroundColor3 = GUI.SelectedTheme.ElementBackground, Size = UDim2.new(1, -10, 0, 35)}, 0.2)
                Animations:Create(uiStroke, {Transparency = 0.5}, 0.2)
            end)

            table.insert(tab.Elements, button)
            return button
        end

        --- Создаёт переключатель
        -- @param name Текст переключателя
        -- @param default Начальное состояние
        -- @param callback Функция обратного вызова
        -- @param flag Флаг для сохранения
        -- @return table Объект переключателя
        function tab:CreateToggle(name, default, callback, flag)
            local toggle = {
                Value = default or false,
                Callback = callback or function() end,
                Flag = flag,
            }

            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1, -10, 0, 35)
            frame.Position = UDim2.new(0, 5, 0, #tab.Elements * 40)
            frame.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
            frame.BackgroundTransparency = 0.2
            frame.Parent = tab.Instance

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = GUI.SelectedTheme.ElementStroke
            uiStroke.Thickness = 1.5
            uiStroke.Transparency = 0.5
            uiStroke.Parent = frame

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.7, 0, 1, 0)
            label.Text = name
            label.TextColor3 = GUI.SelectedTheme.TextColor
            label.Font = Config.Font
            label.TextStrokeTransparency = 0.8
            label.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            label.BackgroundTransparency = 1
            label.Parent = frame

            local switch = Instance.new("TextButton")
            switch.Size = UDim2.new(0, 40, 0, 20)
            switch.Position = UDim2.new(0.85, 0, 0.25, 0)
            switch.Text = toggle.Value and "On" or "Off"
            switch.BackgroundColor3 = toggle.Value and GUI.SelectedTheme.ToggleEnabled or GUI.SelectedTheme.ToggleDisabled
            switch.TextColor3 = GUI.SelectedTheme.TextColor
            switch.Font = Config.Font
            switch.Parent = frame

            local switchStroke = Instance.new("UIStroke")
            switchStroke.Color = toggle.Value and GUI.SelectedTheme.ToggleEnabledStroke or GUI.SelectedTheme.ToggleDisabledStroke
            switchStroke.Thickness = 1
            switchStroke.Parent = switch

            switch.MouseButton1Click:Connect(function()
                toggle.Value = not toggle.Value
                switch.Text = toggle.Value and "On" or "Off"
                switch.BackgroundColor3 = toggle.Value and GUI.SelectedTheme.ToggleEnabled or GUI.SelectedTheme.ToggleDisabled
                switchStroke.Color = toggle.Value and GUI.SelectedTheme.ToggleEnabledStroke or GUI.SelectedTheme.ToggleDisabledStroke
                local success, err = pcall(toggle.Callback, toggle.Value)
                if not success then
                    Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                end
                if toggle.Flag then
                    OmniUI.Flags[toggle.Flag] = toggle.Value
                    if window.ConfigSaving.Enabled then
                        Configurations:Save(OmniUI.Flags)
                    end
                end
            end)

            switch.MouseEnter:Connect(function()
                Animations:Create(switch, {Size = UDim2.new(0, 42, 0, 22)}, 0.2)
                Animations:Create(switchStroke, {Transparency = 0}, 0.2)
            end)

            switch.MouseLeave:Connect(function()
                Animations:Create(switch, {Size = UDim2.new(0, 40, 0, 20)}, 0.2)
                Animations:Create(switchStroke, {Transparency = 0.5}, 0.2)
            end)

            table.insert(tab.Elements, frame)
            return toggle
        end

        --- Создаёт слайдер
        -- @param name Текст слайдера
        -- @param range Диапазон значений {min, max}
        -- @param increment Шаг изменения
        -- @param suffix Суффикс (например, "%")
        -- @param default Начальное значение
        -- @param callback Функция обратного вызова
        -- @param flag Флаг для сохранения
        -- @return table Объект слайдера
        function tab:CreateSlider(name, range, increment, suffix, default, callback, flag)
            local slider = {
                Value = default or range[1],
                Callback = callback or function() end,
                Flag = flag,
            }

            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1, -10, 0, 50)
            frame.Position = UDim2.new(0, 5, 0, #tab.Elements * 55)
            frame.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
            frame.BackgroundTransparency = 0.2
            frame.Parent = tab.Instance

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = GUI.SelectedTheme.ElementStroke
            uiStroke.Thickness = 1.5
            uiStroke.Transparency = 0.5
            uiStroke.Parent = frame

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -10, 0, 20)
            label.Text = name
            label.TextColor3 = GUI.SelectedTheme.TextColor
            label.Font = Config.Font
            label.TextStrokeTransparency = 0.8
            label.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            label.BackgroundTransparency = 1
            label.Parent = frame

            local sliderBar = Instance.new("Frame")
            sliderBar.Size = UDim2.new(1, -10, 0, 8)
            sliderBar.Position = UDim2.new(0, 5, 0, 30)
            sliderBar.BackgroundColor3 = GUI.SelectedTheme.SliderBackground
            sliderBar.Parent = frame

            local progress = Instance.new("Frame")
            progress.Size = UDim2.new((slider.Value - range[1]) / (range[2] - range[1]), 0, 1, 0)
            progress.BackgroundColor3 = GUI.SelectedTheme.SliderProgress
            progress.Parent = sliderBar

            local progressStroke = Instance.new("UIStroke")
            progressStroke.Color = GUI.SelectedTheme.SliderStroke
            progressStroke.Thickness = 1
            progressStroke.Parent = progress

            local valueLabel = Instance.new("TextLabel")
            valueLabel.Size = UDim2.new(0, 50, 0, 20)
            valueLabel.Position = UDim2.new(1, -55, 0, 0)
            valueLabel.Text = tostring(slider.Value) .. (suffix or "")
            valueLabel.TextColor3 = GUI.SelectedTheme.TextColor
            valueLabel.Font = Config.Font
            valueLabel.TextStrokeTransparency = 0.8
            valueLabel.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            valueLabel.BackgroundTransparency = 1
            valueLabel.Parent = frame

            local dragging
            sliderBar.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = true
                end
            end)

            sliderBar.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                    dragging = false
                end
            end)

            UserInputService.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local mouseX = input.Position.X
                    local barX = sliderBar.AbsolutePosition.X
                    local barWidth = sliderBar.AbsoluteSize.X
                    local relative = math.clamp((mouseX - barX) / barWidth, 0, 1)
                    slider.Value = math.floor(range[1] + (range[2] - range[1]) * relative / increment + 0.5) * increment
                    progress.Size = UDim2.new(relative, 0, 1, 0)
                    valueLabel.Text = tostring(slider.Value) .. (suffix or "")
                    local success, err = pcall(slider.Callback, slider.Value)
                    if not success then
                        Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                    end
                    if slider.Flag then
                        OmniUI.Flags[slider.Flag] = slider.Value
                        if window.ConfigSaving.Enabled then
                            Configurations:Save(OmniUI.Flags)
                        end
                    end
                end
            end)

            table.insert(tab.Elements, frame)
            return slider
        end

        --- Создаёт поле ввода
        -- @param name Текст поля
        -- @param placeholder Подсказка
        -- @param default Начальное значение
        -- @param callback Функция обратного вызова
        -- @param flag Флаг для сохранения
        -- @return table Объект поля ввода
        function tab:CreateInput(name, placeholder, default, callback, flag)
            local input = {
                Value = default or "",
                Callback = callback or function() end,
                Flag = flag,
            }

            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1, -10, 0, 35)
            frame.Position = UDim2.new(0, 5, 0, #tab.Elements * 40)
            frame.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
            frame.BackgroundTransparency = 0.2
            frame.Parent = tab.Instance

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = GUI.SelectedTheme.ElementStroke
            uiStroke.Thickness = 1.5
            uiStroke.Transparency = 0.5
            uiStroke.Parent = frame

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.5, 0, 1, 0)
            label.Text = name
            label.TextColor3 = GUI.SelectedTheme.TextColor
            label.Font = Config.Font
            label.TextStrokeTransparency = 0.8
            label.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            label.BackgroundTransparency = 1
            label.Parent = frame

            local textBox = Instance.new("TextBox")
            textBox.Size = UDim2.new(0.5, -5, 0, 25)
            textBox.Position = UDim2.new(0.5, 5, 0.15, 0)
            textBox.Text = input.Value
            textBox.PlaceholderText = placeholder or "Введите текст..."
            textBox.TextColor3 = GUI.SelectedTheme.TextColor
            textBox.BackgroundColor3 = GUI.SelectedTheme.InputBackground
            textBox.Font = Config.Font
            textBox.TextStrokeTransparency = 0.8
            textBox.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            textBox.Parent = frame

            local textBoxStroke = Instance.new("UIStroke")
            textBoxStroke.Color = GUI.SelectedTheme.InputStroke
            textBoxStroke.Thickness = 1
            textBoxStroke.Parent = textBox

            textBox.FocusLost:Connect(function(enterPressed)
                if enterPressed then
                    input.Value = textBox.Text
                    local success, err = pcall(input.Callback, input.Value)
                    if not success then
                        Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                    end
                    if input.Flag then
                        OmniUI.Flags[input.Flag] = input.Value
                        if window.ConfigSaving.Enabled then
                            Configurations:Save(OmniUI.Flags)
                        end
                    end
                end
            end)

            table.insert(tab.Elements, frame)
            return input
        end

        --- Создаёт выпадающий список
        -- @param name Текст списка
        -- @param options Список опций
        -- @param default Начальное значение
        -- @param multiple Разрешить множественный выбор
        -- @param callback Функция обратного вызова
        -- @param flag Флаг для сохранения
        -- @return table Объект выпадающего списка
        function tab:CreateDropdown(name, options, default, multiple, callback, flag)
            local dropdown = {
                Value = default or (multiple and {} or options[1]),
                Callback = callback or function() end,
                Flag = flag,
                Multiple = multiple,
            }

            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1, -10, 0, 35)
            frame.Position = UDim2.new(0, 5, 0, #tab.Elements * 40)
            frame.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
            frame.BackgroundTransparency = 0.2
            frame.Parent = tab.Instance

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = GUI.SelectedTheme.ElementStroke
            uiStroke.Thickness = 1.5
            uiStroke.Transparency = 0.5
            uiStroke.Parent = frame

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.5, 0, 1, 0)
            label.Text = name
            label.TextColor3 = GUI.SelectedTheme.TextColor
            label.Font = Config.Font
            label.TextStrokeTransparency = 0.8
            label.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            label.BackgroundTransparency = 1
            label.Parent = frame

            local dropdownButton = Instance.new("TextButton")
            dropdownButton.Size = UDim2.new(0.5, -5, 0, 25)
            dropdownButton.Position = UDim2.new(0.5, 5, 0.15, 0)
            dropdownButton.Text = multiple and table.concat(dropdown.Value, ", ") or dropdown.Value
            dropdownButton.BackgroundColor3 = GUI.SelectedTheme.DropdownUnselected
            dropdownButton.TextColor3 = GUI.SelectedTheme.TextColor
            dropdownButton.Font = Config.Font
            dropdownButton.TextStrokeTransparency = 0.8
            dropdownButton.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            dropdownButton.Parent = frame

            local dropdownStroke = Instance.new("UIStroke")
            dropdownStroke.Color = GUI.SelectedTheme.ElementStroke
            dropdownStroke.Thickness = 1
            dropdownStroke.Parent = dropdownButton

            local dropdownList = Instance.new("Frame")
            dropdownList.Size = UDim2.new(0.5, -5, 0, 0)
            dropdownList.Position = UDim2.new(0.5, 5, 0, 30)
            dropdownList.BackgroundColor3 = GUI.SelectedTheme.DropdownUnselected
            dropdownList.BackgroundTransparency = 0.2
            dropdownList.Visible = false
            dropdownList.Parent = frame

            local listStroke = Instance.new("UIStroke")
            listStroke.Color = GUI.SelectedTheme.ElementStroke
            listStroke.Thickness = 1
            listStroke.Parent = dropdownList

            local uiListLayout = Instance.new("UIListLayout")
            uiListLayout.SortOrder = Enum.SortOrder.LayoutOrder
            uiListLayout.Parent = dropdownList

            local function updateList()
                for _, child in ipairs(dropdownList:GetChildren()) do
                    if child:IsA("TextButton") then
                        child:Destroy()
                    end
                end
                local height = 0
                for _, option in ipairs(options) do
                    local optionButton = Instance.new("TextButton")
                    optionButton.Size = UDim2.new(1, 0, 0, 25)
                    optionButton.Text = option
                    optionButton.BackgroundColor3 = (multiple and table.find(dropdown.Value, option)) or (dropdown.Value == option) and GUI.SelectedTheme.DropdownSelected or GUI.SelectedTheme.DropdownUnselected
                    optionButton.TextColor3 = GUI.SelectedTheme.TextColor
                    optionButton.Font = Config.Font
                    optionButton.TextStrokeTransparency = 0.8
                    optionButton.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
                    optionButton.Parent = dropdownList

                    local optionStroke = Instance.new("UIStroke")
                    optionStroke.Color = GUI.SelectedTheme.ElementStroke
                    optionStroke.Thickness = 1
                    optionStroke.Parent = optionButton

                    optionButton.MouseButton1Click:Connect(function()
                        if multiple then
                            if table.find(dropdown.Value, option) then
                                table.remove(dropdown.Value, table.find(dropdown.Value, option))
                            else
                                table.insert(dropdown.Value, option)
                            end
                        else
                            dropdown.Value = option
                            dropdownList.Visible = false
                        end
                        dropdownButton.Text = multiple and table.concat(dropdown.Value, ", ") or dropdown.Value
                        updateList()
                        local success, err = pcall(dropdown.Callback, dropdown.Value)
                        if not success then
                            Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                        end
                        if dropdown.Flag then
                            OmniUI.Flags[dropdown.Flag] = dropdown.Value
                            if window.ConfigSaving.Enabled then
                                Configurations:Save(OmniUI.Flags)
                            end
                        end
                    end)
                    height = height + 25
                end
                dropdownList.Size = UDim2.new(0.5, -5, 0, math.min(height, 100))
            end

            updateList()

            dropdownButton.MouseButton1Click:Connect(function()
                dropdownList.Visible = not dropdownList.Visible
            end)

            table.insert(tab.Elements, frame)
            return dropdown
        end

        --- Создаёт привязку клавиши
        -- @param name Текст привязки
        -- @param default Начальная клавиша
        -- @param hold Режим удержания
        -- @param callback Функция обратного вызова
        -- @param flag Флаг для сохранения
        -- @return table Объект привязки
        function tab:CreateKeybind(name, default, hold, callback, flag)
            local keybind = {
                Value = default or "None",
                Callback = callback or function() end,
                Flag = flag,
                Hold = hold,
                Binding = false,
            }

            local frame = Instance.new("Frame")
            frame.Size = UDim2.new(1, -10, 0, 35)
            frame.Position = UDim2.new(0, 5, 0, #tab.Elements * 40)
            frame.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
            frame.BackgroundTransparency = 0.2
            frame.Parent = tab.Instance

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = GUI.SelectedTheme.ElementStroke
            uiStroke.Thickness = 1.5
            uiStroke.Transparency = 0.5
            uiStroke.Parent = frame

            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(0.5, 0, 1, 0)
            label.Text = name
            label.TextColor3 = GUI.SelectedTheme.TextColor
            label.Font = Config.Font
            label.TextStrokeTransparency = 0.8
            label.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            label.BackgroundTransparency = 1
            label.Parent = frame

            local keybindButton = Instance.new("TextButton")
            keybindButton.Size = UDim2.new(0.5, -5, 0, 25)
            keybindButton.Position = UDim2.new(0.5, 5, 0.15, 0)
            keybindButton.Text = keybind.Value
            keybindButton.BackgroundColor3 = GUI.SelectedTheme.InputBackground
            keybindButton.TextColor3 = GUI.SelectedTheme.TextColor
            keybindButton.Font = Config.Font
            keybindButton.TextStrokeTransparency = 0.8
            keybindButton.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            keybindButton.Parent = frame

            local keybindStroke = Instance.new("UIStroke")
            keybindStroke.Color = GUI.SelectedTheme.ElementStroke
            keybindStroke.Thickness = 1
            keybindStroke.Parent = keybindButton

            keybindButton.MouseButton1Click:Connect(function()
                keybind.Binding = true
                keybindButton.Text = "..."
            end)

            local connection = UserInputService.InputBegan:Connect(function(input, processed)
                if keybind.Binding and not processed then
                    local key = input.KeyCode.Name
                    if key ~= "Unknown" then
                        keybind.Value = key
                        keybindButton.Text = key
                        keybind.Binding = false
                        local success, err = pcall(keybind.Callback, key)
                        if not success then
                            Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                        end
                        if keybind.Flag then
                            OmniUI.Flags[keybind.Flag] = keybind.Value
                            if window.ConfigSaving.Enabled then
                                Configurations:Save(OmniUI.Flags)
                            end
                        end
                    end
                elseif keybind.Value ~= "None" and input.KeyCode.Name == keybind.Value and not processed then
                    if keybind.Hold then
                        local held = true
                        local holdConnection
                        holdConnection = input.Changed:Connect(function(prop)
                            if prop == "UserInputState" then
                                held = false
                                holdConnection:Disconnect()
                            end
                        end)
                        task.spawn(function()
                            while held do
                                local success, err = pcall(keybind.Callback, true)
                                if not success then
                                    Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                                end
                                task.wait()
                            end
                            local success, err = pcall(keybind.Callback, false)
                            if not success then
                                Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                            end
                        end)
                    else
                        local success, err = pcall(keybind.Callback, true)
                        if not success then
                            Notifications:Create("Ошибка", "Ошибка callback: " .. tostring(err), 5, "Error")
                        end
                    end
                end
            end)

            frame.Destroying:Connect(function()
                connection:Disconnect()
            end)

            table.insert(tab.Elements, frame)
            return keybind
        end

        --- Создаёт метку
        -- @param name Текст метки
        -- @param icon ID иконки
        -- @param color Цвет текста
        -- @param warning Флаг предупреждения
        -- @return TextLabel Экземпляр метки
        function tab:CreateLabel(name, icon, color, warning)
            local label = Instance.new("TextLabel")
            label.Size = UDim2.new(1, -10, 0, 30)
            label.Position = UDim2.new(0, 5, 0, #tab.Elements * 35)
            label.Text = name
            label.TextColor3 = color or (warning and Color3.fromRGB(255, 50, 50) or GUI.SelectedTheme.TextColor)
            label.Font = Config.Font
            label.TextStrokeTransparency = 0.8
            label.TextStrokeColor3 = warning and Color3.fromRGB(200, 0, 0) or GUI.SelectedTheme.TextGlow
            label.BackgroundTransparency = 1
            label.Parent = tab.Instance

            if icon then
                local iconLabel = Instance.new("ImageLabel")
                iconLabel.Size = UDim2.new(0, 20, 0, 20)
                iconLabel.Position = UDim2.new(0, -25, 0, 5)
                iconLabel.Image = Icons:GetIcon(icon)
                iconLabel.BackgroundTransparency = 1
                iconLabel.Parent = label
            end

            table.insert(tab.Elements, label)
            return label
        end

        --- Создаёт параграф
        -- @param title Заголовок
        -- @param content Текст
        -- @return Frame Экземпляр параграфа
        function tab:CreateParagraph(title, content)
            local paragraph = Instance.new("Frame")
            paragraph.Size = UDim2.new(1, -10, 0, 55)
            paragraph.Position = UDim2.new(0, 5, 0, #tab.Elements * 60)
            paragraph.BackgroundColor3 = GUI.SelectedTheme.ElementBackground
            paragraph.BackgroundTransparency = 0.2
            paragraph.Parent = tab.Instance

            local uiStroke = Instance.new("UIStroke")
            uiStroke.Color = GUI.SelectedTheme.ElementStroke
            uiStroke.Thickness = 1.5
            uiStroke.Transparency = 0.5
            uiStroke.Parent = paragraph

            local titleLabel = Instance.new("TextLabel")
            titleLabel.Size = UDim2.new(1, -10, 0, 20)
            titleLabel.Text = title
            titleLabel.TextColor3 = GUI.SelectedTheme.TextColor
            titleLabel.Font = Config.Font
            titleLabel.TextStrokeTransparency = 0.8
            titleLabel.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            titleLabel.BackgroundTransparency = 1
            titleLabel.Parent = paragraph

            local contentLabel = Instance.new("TextLabel")
            contentLabel.Size = UDim2.new(1, -10, 0, 35)
            contentLabel.Position = UDim2.new(0, 5, 0, 20)
            contentLabel.Text = content
            contentLabel.TextColor3 = GUI.SelectedTheme.TextColor
            contentLabel.Font = Config.Font
            contentLabel.TextStrokeTransparency = 0.8
            contentLabel.TextStrokeColor3 = GUI.SelectedTheme.TextGlow
            contentLabel.TextWrapped = true
            contentLabel.BackgroundTransparency = 1
            contentLabel.Parent = paragraph

            table.insert(tab.Elements, paragraph)
            return paragraph
        end

        return tab
    end

    --- Устанавливает видимость окна
    -- @param visible Флаг видимости
    function window:SetVisible(visible)
        window.Visible = visible
        window.Hidden = not visible
        window.Instance.Enabled = visible
        if visible then
            Notifications:Create("Хак активирован", "OmniUI захватил систему.", 5, "Info")
            Animations:Create(window.MainFrame, {Position = UDim2.new(0.5, -225, 0.5, -200), BackgroundTransparency = 0}, 0.7)
        else
            Notifications:Create("Хак скрыт", "Нажмите " .. window.Keybind .. " для активации.", 5, "Info")
            Animations:Create(window.MainFrame, {Position = UDim2.new(0.5, -225, 0.5, 200), BackgroundTransparency = 1}, 0.7)
        end
    end

    --- Загружает конфигурацию
    function window:LoadConfiguration()
        if not window.ConfigSaving.Enabled then return end
        local data = Configurations:Load()
        for flag, value in pairs(data) do
            if OmniUI.Flags[flag] then
                OmniUI.Flags[flag] = value
            end
        end
        Notifications:Create("Конфигурация загружена", "Настройки восстановлены.", 5, "Info")
    end

    local keybindConnection = UserInputService.InputBegan:Connect(function(input, processed)
        if input.KeyCode.Name == window.Keybind and not processed then
            window:SetVisible(not window.Visible)
        end
    end)

    window.Instance.Destroying:Connect(function()
        keybindConnection:Disconnect()
    end)

    Notifications:Create("Хак активирован", "OmniUI захватил систему.", 5, "Info")
    print("[OmniUI] Окно создано: " .. window.Name .. ", Parent: " .. window.Instance.Parent.Name)

    GUI.Windows[window.Name] = window
    Analytics:SendReport()
    return window
end

-- Инициализация
OmniUI.GUI = GUI
OmniUI.API = API
OmniUI.Notifications = Notifications
OmniUI.Configurations = Configurations
OmniUI.Analytics = Analytics
OmniUI.Animations = Animations
OmniUI.Icons = Icons

-- Пример использования
if RunService:IsStudio() then
    local window = GUI:CreateWindow({
        Name = "CyberForge Hack",
        ConfigurationSaving = { Enabled = true, FileName = "HackConfig" },
    })

    local tab = window:CreateTab("Exploits", "Default")
    tab:CreateButton("God Mode", function()
        local playerId = Players.LocalPlayer.UserId
        local data = API:UpdateInventory(playerId, "god_mode", 1)
        Notifications:Create("Успех", "God Mode: Активирована неуязвимость", 5, "Info")
    end)

    tab:CreateToggle("Speed Hack", false, function(value)
        local playerId = Players.LocalPlayer.UserId
        local data = API:UpdateInventory(playerId, "speed_hack", value and 1 or 0)
        Notifications:Create("Успех", "Speed Hack: " .. (value and "Скорость света" or "Отключено"), 5, "Info")
    end, "SpeedHackToggle")

    tab:CreateSlider("Health", {0, 100}, 10, "%", 50, function(value)
        Notifications:Create("Здоровье установлено", "Уровень: " .. value .. "%", 5, "Info")
    end, "HealthSlider")

    tab:CreateInput("Target Player", "Введите имя игрока...", "", function(text)
        Notifications:Create("Цель выбрана", "Заблокировано на: " .. text, 5, "Info")
    end, "TargetInput")

    tab:CreateDropdown("Exploit Mode", {"Silent", "Aggressive", "Stealth"}, "Silent", false, function(mode)
        Notifications:Create("Режим изменён", "Режим эксплойта: " .. mode, 5, "Info")
    end, "ExploitModeDropdown")

    tab:CreateKeybind("Teleport", "T", false, function()
        Notifications:Create("Телепорт", "Перемещение на целевую позицию", 5, "Info")
    end, "TeleportKeybind")

    tab:CreateLabel("Статус: Онлайн", "Info")
    tab:CreateParagraph("CyberForge", "Разрушайте систему с мощью OmniUI.")

    window:LoadConfiguration()

    -- Тест смены темы
    task.spawn(function()
        task.wait(5)
        GUI:ChangeTheme("NeonTokyo")
    end)
end

return OmniUI
